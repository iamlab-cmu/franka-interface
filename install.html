

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; franka-interface 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Network Configuration" href="network.html" />
    <link rel="prev" title="Welcome to franka-interface’s Documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> franka-interface
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recommended-computer-configuration">Recommended Computer Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computer-setup-instructions">Computer Setup Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protobuf">Protobuf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#virtual-environment">Virtual Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#realtime-kernel">Realtime Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-your-own-realtime-kernel">Compiling your own Realtime Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cpu-monitoring-utilities">CPU Monitoring Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#franka-interface-installation-steps">Franka-Interface Installation Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="network.html">Network Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">franka-interface</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>A computer with Ubuntu 18.04 / 20.04 Realtime Kernel and at least 1 ethernet port.</li>
<li>ROS Melodic / Noetic or ROS2 Foxy / Humble</li>
<li><a class="reference external" href="https://developers.google.com/protocol-buffers">Google Protocol Buffer</a></li>
</ul>
<div class="section" id="recommended-computer-configuration">
<h3>Recommended Computer Configuration<a class="headerlink" href="#recommended-computer-configuration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>2 Ethernet ports</li>
<li>Wifi</li>
<li>Intel i5-9600K or better</li>
<li>16 GB of RAM</li>
<li>256 GB SSD or more</li>
</ul>
</div>
</div>
<div class="section" id="computer-setup-instructions">
<h2>Computer Setup Instructions<a class="headerlink" href="#computer-setup-instructions" title="Permalink to this headline">¶</a></h2>
<p>These instructions are assuming that you just freshly installed <a class="reference external" href="https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview">Ubuntu 18.04 / 20.04</a> on the computer, which we will call the Control PC.</p>
<ol class="arabic">
<li><p class="first">First make sure your computer is completely up to date with all packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">upgrade</span>
</pre></div>
</div>
</li>
<li><p class="first">Install basic packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">curl</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span> <span class="n">git</span> <span class="n">vim</span> <span class="n">terminator</span>
</pre></div>
</div>
</li>
<li><p class="first">Install <a class="reference external" href="http://wiki.ros.org/melodic/Installation/Ubuntu">ROS Melodic</a> or <a class="reference external" href="http://wiki.ros.org/noetic/Installation/Ubuntu">ROS Noetic</a>. Make sure that <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/ros/melodic/setup.bash</span></code> or <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/ros/noetic/setup.bash</span></code> is in your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file.</p>
</li>
</ol>
<div class="section" id="protobuf">
<h3>Protobuf<a class="headerlink" href="#protobuf" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">First determine the number of cores on your computer using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nproc</span>
</pre></div>
</div>
</li>
<li><p class="first">Execute the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">autoconf</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">curl</span> <span class="n">make</span> <span class="n">g</span><span class="o">++</span> <span class="n">unzip</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">protocolbuffers</span><span class="o">/</span><span class="n">protobuf</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v21</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">protobuf</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="mf">21.8</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">protobuf</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="mf">21.8</span><span class="o">.</span><span class="n">zip</span>
<span class="n">cd</span> <span class="n">protobuf</span><span class="o">-</span><span class="mf">21.8</span>
<span class="o">./</span><span class="n">configure</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the number that was previously printed out using the <code class="docutils literal notranslate"><span class="pre">nproc</span></code> command above and substitute it as <code class="docutils literal notranslate"><span class="pre">N</span></code> below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">jN</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
<span class="n">sudo</span> <span class="n">ldconfig</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="virtual-environment">
<h3>Virtual Environment<a class="headerlink" href="#virtual-environment" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Install Python3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="o">-</span><span class="n">distutils</span>
</pre></div>
</div>
</li>
<li><p class="first">Install Pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">pypa</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="n">pip</span><span class="o">.</span><span class="n">py</span> <span class="o">|</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">H</span> <span class="n">python3</span>
</pre></div>
</div>
</li>
<li><p class="first">Install Virtual Environment and Other Useful Python Packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">H</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">matplotlib</span> <span class="n">virtualenv</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a Virtual Environment for Franka-interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">virtualenv</span> <span class="o">-</span><span class="n">p</span> <span class="n">python3</span> <span class="n">franka_virtual_env</span>
</pre></div>
</div>
</li>
<li><p class="first">Enter into the Virtual Environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">franka_virtual_env</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</li>
<li><p class="first">How to exit the Virtual Environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deactivate</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="realtime-kernel">
<h3>Realtime Kernel<a class="headerlink" href="#realtime-kernel" title="Permalink to this headline">¶</a></h3>
<p>If you don’t want to go through the hassle of compiling the realtime kernel yourself, feel free to download a precompiled version for Ubuntu 18.04 <a class="reference external" href="https://drive.google.com/file/d/1VCPCe8m0CsgBUkfk2D_89UBAVW3QKjAQ/view?usp=sharing">here</a> or Ubuntu 20.04 <a class="reference external" href="https://drive.google.com/file/d/1mPtzHEIJW0-fIsFtA8vS6zyZBbzqmVtI/view?usp=sharing">here</a>. Otherwise skip down to the next section first and then come back to this section and start from step 5.</p>
<ol class="arabic">
<li><p class="first">Simply unzip the packages into your <code class="docutils literal notranslate"><span class="pre">Downloads</span></code> folder.</p>
</li>
<li><p class="first">Enter the directory where you unzipped the files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">Downloads</span><span class="o">/</span><span class="n">Realtime</span>\ <span class="n">Kernel</span>\ <span class="n">Files</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Install the realtime kernel by typing the following command. If you are using Ubuntu 18.04, switch all of the 5.15.55-rt48 to 5.4.3-rt1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span> <span class="n">linux</span><span class="o">-</span><span class="n">libc</span><span class="o">-</span><span class="n">dev_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart your computer after it has finished installing the realtime kernel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
<li><p class="first">Once your computer has finished rebooting, <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> should show the new kernel: 5.15.55-rt48 or 5.4.3-rt1 and <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/sys/kernel/realtime</span></code> should show an output of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</li>
<li><p class="first">Next you need to set realtime settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo addgroup realtime
sudo usermod -a -G realtime $(whoami)
</pre></div>
</div>
</li>
<li><p class="first">Add the following to the end of <code class="docutils literal notranslate"><span class="pre">/etc/security/limits.conf</span></code> (with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">gedit</span></code> or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">&lt;your</span> <span class="pre">favorite</span> <span class="pre">editor&gt;</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@realtime</span> <span class="n">soft</span> <span class="n">rtprio</span> <span class="mi">99</span>
<span class="nd">@realtime</span> <span class="n">soft</span> <span class="n">priority</span> <span class="mi">99</span>
<span class="nd">@realtime</span> <span class="n">soft</span> <span class="n">memlock</span> <span class="mi">102400</span>
<span class="nd">@realtime</span> <span class="n">hard</span> <span class="n">rtprio</span> <span class="mi">99</span>
<span class="nd">@realtime</span> <span class="n">hard</span> <span class="n">priority</span> <span class="mi">99</span>
<span class="nd">@realtime</span> <span class="n">hard</span> <span class="n">memlock</span> <span class="mi">102400</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart your computer again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="compiling-your-own-realtime-kernel">
<h3>Compiling your own Realtime Kernel<a class="headerlink" href="#compiling-your-own-realtime-kernel" title="Permalink to this headline">¶</a></h3>
<p>In order to communicate with the Franka Panda Research Arm at 1 kHz, we need Ubuntu to be patched with the <code class="docutils literal notranslate"><span class="pre">PREEMPT_RT</span></code> patch. This is also known as the “realtime kernel” patch.</p>
<ol class="arabic">
<li><p class="first">First, install required dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">bc</span> <span class="n">curl</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span> <span class="n">fakeroot</span> <span class="n">gnupg2</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">lsb</span><span class="o">-</span><span class="n">release</span> <span class="n">libelf</span><span class="o">-</span><span class="n">dev</span> <span class="n">bison</span> <span class="n">flex</span>
</pre></div>
</div>
</li>
<li><p class="first">Secondly, you need to pick a mainline kernel version that has a preempt_rt [“RT”] patch. What worked best was selecting the next closest RT kernel available to what was installed on the system. (List of RT versions: <a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/">https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/</a>)</p>
</li>
</ol>
<p>3. Out of the box, Ubuntu 18.04.6 LTS comes with kernel “5.4.0”. So we picked 5.4.3 <a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/5.4/older/">here</a>. For Ubuntu 20.04.4 LTS, it comes with kernel “5.15.0” so we picked 5.15.55 <a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/5.15/">here</a>.
You can identify what kernel version you are currently using with the command <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code>.</p>
<ol class="arabic" start="4">
<li><p class="first">We will download both the mainline version of the kernel we want along with the RT patch, extract the mainline kernel and apply the RT patch, then compile the kernel and install it.</p>
</li>
<li><p class="first">Create the directory and download the kernel files (if you are using Ubuntu 18.04, we used 5.4.3):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">preempt_rt_5</span><span class="o">.</span><span class="mf">15.55</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">preempt_rt_5</span><span class="o">.</span><span class="mf">15.55</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">SLO</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">v5</span><span class="o">.</span><span class="n">x</span><span class="o">/</span><span class="n">linux</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mf">55.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">SLO</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="mf">5.15</span><span class="o">/</span><span class="n">patch</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">xz</span>
</pre></div>
</div>
</li>
</ol>
<p>6. (In the patch directory (<a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/5.15/">https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/5.15/</a> in this case) you may see both <code class="docutils literal notranslate"><span class="pre">patch</span></code> and <code class="docutils literal notranslate"><span class="pre">patches</span></code> file. Use <code class="docutils literal notranslate"><span class="pre">patch</span></code> – it’s one file that contains everything that’s needed.)
The <code class="docutils literal notranslate"><span class="pre">.sign</span></code> files are used to verify the files (if you’d like – it’s optional).</p>
<ol class="arabic" start="7">
<li><p class="first">Decompress tar files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xz</span> <span class="o">-</span><span class="n">d</span> <span class="n">linux</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mf">55.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="n">xz</span> <span class="o">-</span><span class="n">d</span> <span class="n">patch</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">xz</span>
</pre></div>
</div>
</li>
<li><p class="first">Apply the kernel patch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="n">xf</span> <span class="n">linux</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mf">55.</span><span class="n">tar</span>
<span class="n">cd</span> <span class="n">linux</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">/</span>
<span class="n">patch</span> <span class="o">-</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="o">../</span><span class="n">patch</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48</span><span class="o">.</span><span class="n">patch</span>
</pre></div>
</div>
</li>
<li><p class="first">Follow additional kernel configuration options <a class="reference external" href="https://docs.ros.org/en/foxy/Tutorials/Miscellaneous/Building-Realtime-rt_preempt-kernel-for-ROS-2.html">here</a>.</p>
</li>
<li><p class="first">If you run into errors with certificates, I followed instructions <a class="reference external" href="https://askubuntu.com/questions/1329538/compiling-the-kernel-5-11-11">here</a>. and <a class="reference external" href="https://stackoverflow.com/questions/61657707/btf-tmp-vmlinux-btf-pahole-pahole-is-not-available">here</a>.</p>
</li>
<li><p class="first">Now, we want to install the new <code class="docutils literal notranslate"><span class="pre">.deb</span></code> packages, but not ones with <code class="docutils literal notranslate"><span class="pre">dbg</span></code> in the file name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">..</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">55</span><span class="o">-</span><span class="n">rt48_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span> <span class="n">linux</span><span class="o">-</span><span class="n">libc</span><span class="o">-</span><span class="n">dev_5</span><span class="o">.</span><span class="mf">15.55</span><span class="o">-</span><span class="n">rt48</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart your computer after it has finished installing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="cpu-monitoring-utilities">
<h3>CPU Monitoring Utilities<a class="headerlink" href="#cpu-monitoring-utilities" title="Permalink to this headline">¶</a></h3>
<p>Now, we want to install some utilities and files that will maintain the correct CPU governor mode. (For reference, there are usually two CPU governor modes available: <code class="docutils literal notranslate"><span class="pre">powersave</span></code> and <code class="docutils literal notranslate"><span class="pre">performance</span></code>. We always want to run the Control PC in <code class="docutils literal notranslate"><span class="pre">performance</span></code> mode, which maintains the maximum CPU frequency. <code class="docutils literal notranslate"><span class="pre">Powersave</span></code> is great for laptops, not laboratory experiments. The following is adapted from <a class="reference external" href="https://askubuntu.com/questions/929884/how-to-set-performance-instead-of-powersave-as-default">https://askubuntu.com/questions/929884/how-to-set-performance-instead-of-powersave-as-default</a> and <a class="reference external" href="https://askubuntu.com/questions/621184/how-to-make-cpupower-not-reset-after-each-restart">https://askubuntu.com/questions/621184/how-to-make-cpupower-not-reset-after-each-restart</a>)</p>
<ol class="arabic">
<li><p class="first">Run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">indicator</span><span class="o">-</span><span class="n">cpufreq</span> <span class="n">cpufrequtils</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart the computer and then confirm that <code class="docutils literal notranslate"><span class="pre">indicator-cpufreq</span></code> starts when logged in. You should see what looks like a CPU icon in the system toolbar, with a drop-down menu that shows the current CPU governor. You can select the <code class="docutils literal notranslate"><span class="pre">performance</span></code> mode here, but we will now add files to do this automatically. Run the following terminal commands in order.</p>
</li>
<li><p class="first">Defining the default CPU governor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;GOVERNOR=&quot;</span><span class="n">performance</span><span class="s2">&quot;&quot;</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">cpufrequtils</span>
</pre></div>
</div>
</li>
<li><p class="first">Restarting <code class="docutils literal notranslate"><span class="pre">cpufrequtils</span></code> so that performance mode is selected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cpufrequtils</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
<li><p class="first">Creating the <code class="docutils literal notranslate"><span class="pre">cpu.sh</span></code> script that restarts cpufrequtils:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">gedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cpu</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Add the following lines to <code class="docutils literal notranslate"><span class="pre">cpu.sh</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sleep</span> <span class="mi">60</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cpufrequtils</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
<li><p class="first">Enabling <code class="docutils literal notranslate"><span class="pre">cpu.sh</span></code> to be executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cpu</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Allowing cpu.sh to be executed at startup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span> <span class="n">cpu</span><span class="o">.</span><span class="n">sh</span> <span class="n">defaults</span>
</pre></div>
</div>
</li>
<li><p class="first">Creating the /etc/rc.local file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">gedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">local</span>
</pre></div>
</div>
</li>
<li><p class="first">Add the following lines to /etc/rc.local:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh -e</span>
<span class="c1">#</span>
<span class="c1"># rc.local</span>
<span class="c1">#</span>
<span class="c1"># This script is executed at the end of each multiuser runlevel.</span>
<span class="c1"># Make sure that the script will &quot;exit 0&quot; on success or any other</span>
<span class="c1"># value on error.</span>
<span class="c1">#</span>
<span class="c1"># In order to enable or disable this script just change the execution</span>
<span class="c1"># bits.</span>
<span class="c1">#</span>
<span class="c1"># By default this script does nothing.</span>

<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cpu</span><span class="o">.</span><span class="n">sh</span> <span class="o">&amp;</span>

<span class="n">exit</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Make rc.local executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">local</span>
</pre></div>
</div>
</li>
<li><p class="first">Reboot the computer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ol>
<p>In short, we have defined the default CPU governor, then created several processes for Ubuntu to automatically select this governor when you log in.</p>
<p>It is important to test that the correct CPU governor mode is automatically selected on startup, because using the wrong mode may adversely affect communications with the robot arms and thus experiments. We want this to be automatically set correctly when logging in to the computer and not have to deal with it.</p>
<p>From a computer reboot, log in to the computer.
Select the indicator-cpufreq icon to display the drop-down menu, but do not select anything. We will keep the menu open during this test.
Observe that the governor is currently set to performance.
After some time after login (20-40 seconds), a system process will change this to powersave. You will see this change automatically in the menu.</p>
<p>However, after about 60 seconds, you should observe that the governor automatically changes back to performance.
This happens because of the commands we added to the <code class="docutils literal notranslate"><span class="pre">/etc/rc.local</span></code> file!</p>
<p>If you observe that the governor properly gets changed to performance mode, then everything has been set up correctly.</p>
</div>
</div>
<div class="section" id="franka-interface-installation-steps">
<h2>Franka-Interface Installation Steps<a class="headerlink" href="#franka-interface-installation-steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Clone the Franka-interface Repository and its Submodules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">iamlab</span><span class="o">-</span><span class="n">cmu</span><span class="o">/</span><span class="n">franka</span><span class="o">-</span><span class="n">interface</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">franka</span><span class="o">-</span><span class="n">interface</span>
</pre></div>
</div>
</li>
<li><p class="first">Clone LibFranka corresponding to your robot version. For example if your firmware is 3.x use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">./</span><span class="n">bash_scripts</span><span class="o">/</span><span class="n">clone_libfranka</span><span class="o">.</span><span class="n">sh</span> <span class="mi">3</span>
</pre></div>
</div>
</li>
<li><p class="first">If you are using a Franka Research 3, you should use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">./</span><span class="n">bash_scripts</span><span class="o">/</span><span class="n">clone_libfranka</span><span class="o">.</span><span class="n">sh</span> <span class="mi">6</span>
</pre></div>
</div>
</li>
<li><p class="first">In addition, if you are using a Franka Research 3, you should go to the following file (franka-interface/include/franka-interface/termination_handler/termination_handler.h) and comment lines 97 and 98 and uncomment lines 102 and 103:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Franka</span> <span class="n">Panda</span> <span class="n">Joint</span> <span class="n">Limits</span> <span class="kn">from</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">frankaemika</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">control_parameters</span><span class="o">.</span><span class="n">html</span>
<span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span> <span class="n">max_joint_limits_</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span><span class="p">{</span><span class="mf">2.88</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">3.74</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">};</span>
<span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span> <span class="n">min_joint_limits_</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span><span class="p">{</span><span class="o">-</span><span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.06</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0025</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.88</span><span class="p">};</span>

<span class="o">//</span> <span class="n">Comment</span> <span class="n">the</span> <span class="mi">2</span> <span class="n">lines</span> <span class="n">above</span> <span class="ow">and</span> <span class="n">uncomment</span> <span class="n">the</span> <span class="mi">2</span> <span class="n">lines</span> <span class="n">below</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">Franka</span> <span class="n">Research</span> <span class="mi">3</span>
<span class="o">//</span> <span class="n">Franka</span> <span class="n">Research</span> <span class="mi">3</span> <span class="n">Joint</span> <span class="n">Limits</span> <span class="kn">from</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">frankaemika</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">control_parameters</span><span class="o">.</span><span class="n">html</span>
<span class="o">//</span> <span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span> <span class="n">max_joint_limits_</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span><span class="p">{</span><span class="mf">2.73</span><span class="p">,</span> <span class="mf">1.77</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.14</span><span class="p">,</span> <span class="mf">2.79</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">};</span>
<span class="o">//</span> <span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span> <span class="n">min_joint_limits_</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">double</span><span class="p">,</span> <span class="mi">7</span><span class="o">&gt;</span><span class="p">{</span><span class="o">-</span><span class="mf">2.73</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.77</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.79</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Build LibFranka:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">./</span><span class="n">bash_scripts</span><span class="o">/</span><span class="n">make_libfranka</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">If you ran the command clone_libfranka.sh with the number 5, you should follow the additional commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">libfranka</span><span class="o">/</span><span class="n">build</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
<span class="n">cd</span> <span class="o">../../</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">frankaemika</span><span class="o">/</span><span class="n">franka_ros</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">franka_ros</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="mf">0.9</span><span class="o">.</span><span class="mi">1</span>
<span class="n">cd</span> <span class="o">../../../</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="6">
<li><p class="first">If you have the franka research 3 and ran the command clone_libfranka.sh with the number 6, you should follow the additional commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">libfranka</span><span class="o">/</span><span class="n">build</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
<span class="n">cd</span> <span class="o">../../</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">frankaemika</span><span class="o">/</span><span class="n">franka_ros</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">franka_ros</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="mf">0.10</span><span class="o">.</span><span class="mi">0</span>
<span class="n">cd</span> <span class="o">../../../</span>
</pre></div>
</div>
</li>
<li><p class="first">Otherwise, if you used clone_libfranka.sh with the numbers 2, 3, or 4, follow the below command to install the <code class="docutils literal notranslate"><span class="pre">franka_ros</span></code> package. Switch noetic to melodic if you are on Ubuntu 18.04:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ros</span><span class="o">-</span><span class="n">noetic</span><span class="o">-</span><span class="n">libfranka</span> <span class="n">ros</span><span class="o">-</span><span class="n">noetic</span><span class="o">-</span><span class="n">franka</span><span class="o">-</span><span class="n">ros</span>
</pre></div>
</div>
</li>
<li><p class="first">Build franka-interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">./</span><span class="n">bash_scripts</span><span class="o">/</span><span class="n">make_franka_interface</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Enter the franka virtual environment (<a class="reference internal" href="#virtual-environment"><span class="std std-ref">Virtual Environment</span></a>) and then run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">catkin</span><span class="o">-</span><span class="n">tools</span> <span class="n">empy</span>
<span class="n">bash</span> <span class="o">./</span><span class="n">bash_scripts</span><span class="o">/</span><span class="n">make_catkin</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Afterwards source the <code class="docutils literal notranslate"><span class="pre">catkin_ws</span></code> using the following command:</p>
<p>source catkin_ws/devel/setup.bash</p>
</li>
<li><p class="first">Add the following lines to the end of your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file:</p>
<p>source /path/to/franka_virtual_env/franka/bin/activate
source /path/to/franka-interface/catkin_ws/devel/setup.bash –extend</p>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="network.html" class="btn btn-neutral float-right" title="Network Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to franka-interface’s Documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2025, Kevin Zhang, Mohit Sharma, Jacky Liang, Oliver Kroemer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>